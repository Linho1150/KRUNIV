<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, maximum-scale=1.0, minimum-scale=1, user-scalable=yes,initial-scale=1.0" />
  <link rel="stylesheet" type="text/css" href="./thema.css" />
  <title>KRuniv</title>

  <script type='text/javascript' src='http://code.jquery.com/jquery-1.8.3.js'></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.min.js"></script>
  <meta name="theme-color" content="#563d7c">

</head>

<!--#595857 #F2ECE9 #A6A3A1 #262626 #0D0D0D -->

<body style="background:#F2ECE9;">
  <script>
    $("#m1").show();
    $("#m2").hide();
    $("#m3").hide();
    $("#m4").hide();
    $("#m5").hide();
    $("#m6").hide();
    $("#m7").hide();
    $("#m8").hide();
  </script>
  <nav style="background-color:#A6A3A1;">
    <a class="logo" href="#">KRuniv</a>
    <ul class="itembox">
        <li >
          <a class="item" href="#">종합대학 경쟁률</a>
        </li>
        <li >
          <a class="item" href="#">전문대학 경쟁률</a>
        </li>
        <li>
          <a class="item" href="#">종합대학 남녀성비</a>
        </li>
        <li>
          <a class="item" href="#">전문대학 남녀성비</a>
        </li>
    </ul>
      <select class="itembox_mid">
          <option value="인문계열">종합대학 경쟁률</option>
          <option value="인문계열">전문대학 경쟁률</option>
          <option value="인문계열">종합대학 남녀성비</option>
          <option value="인문계열">전문대학 남녀성비</option>
      </select>
    <select class="itembox_bottom">
        <option value="인문계열">종합대학 경쟁률</option>
        <option value="인문계열">전문대학 경쟁률</option>
        <option value="인문계열">종합대학 남녀성비</option>
        <option value="인문계열">전문대학 남녀성비</option>
    </select>
    </div>
  </nav>

  <main role="main">
    <h3 style="text-align: center; color:#595857;">종합대학 경쟁률 그래프</h3>
    <canvas id="canvas" style="min-width:200px;"></canvas>

    <br>
    <div id="selectbox">
      <select name="대분류" value="대분류">
        <option value="인문계열">인문계열의</option>
        <option value="사회계열">사회계열의</option>
        <option value="교육계열">교육계열의</option>
      </select>
      <select name="중분류">
        <option value="언어 문학">언어 문학</option>
        <option value="인문과학">인문과학의</option>
      </select>
      <select name="소분류">
        <option value="국어ㆍ국문학">국어ㆍ국문학</option>
        <option value="국어 국무">영어영문학</option>
        <option value="국문">몰라</option>
      </select>
  </div>
  </main>

  <script type='text/javascript'>

    // 초기 그래프 설정 =========================================================
    var ctx = document.getElementById('canvas');
    var config = {
      type: 'line',
      data: {
        labels: ['2011', '2012', '2013', '2014', '2015', '2016', '2017', '2018', '2019'],
      },
      options: {
        title: {
          display: false,
          text: '경쟁률 그래프'
        },
        title: {
          display: false,
          text: '경쟁률 그래프'
        },
        tooltips: {
          mode: 'index',
          intersect: false,
        },
        hover: {
          mode: 'nearest',
          intersect: true
        },
        scales: {
          yAxes: [{
            display: true,
            ticks: {
              min: 0
            },
            scaleLabel: {
              display: true,
              labelString: '경쟁률'
            }
          }]
        }
      }
    };
    //차트 그리기
    var myChart = new Chart(ctx, config);


    //중분류 버튼 클릭
    $('#menu_md a').click(function() {
      var cdata, cname;

      $('#btn_md').text($(this).text());
      cname = $(this).text();
      cdata = $(this).attr('cdata');
      cdata = cdata.split(",");

      var color1 = Math.floor(Math.random() * 256);
      var color2 = Math.floor(Math.random() * 256);
      var color3 = Math.floor(Math.random() * 256);

      var newDataset = {
        label: cname,
        borderColor: 'rgba(' + color1 + ', ' + color2 + ', ' + color3 + ', 1)',
        backgroundColor: 'rgba(' + color1 + ', ' + color2 + ', ' + color3 + ', 1)',
        data: cdata,
        fill: false
      }


      // chart에 newDataset 푸쉬
      config.data.datasets.push(newDataset);
      myChart.update(); //차트 업데이트


    });
  </script>
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
  <script>window.jQuery || document.write('<script src="js/vendor/jquery.slim.min.js"><\/script>')</script>
  <script src="js/bootstrap.bundle.min.js"></script>

  <script>
    var jsonArray;

    function printJson(target){
      const obj = JSON.parse(target);
      jsonArray=obj;
    }

    function loadJSON(callback) {   
      var xobj = new XMLHttpRequest();
          xobj.overrideMimeType("application/json");
      xobj.open('GET', 'univ_total.json', true);
      xobj.onreadystatechange = function () {
            if (xobj.readyState == 4 && xobj.status == "200") {
              callback(xobj.responseText);
            }
      };
      xobj.send(null);  
    }
    loadJSON(printJson);
    
    
    setTimeout(function() {
      var rstLarge = [];
      var rstMedium = [];
      var rstSmall = [];
      for(tmp in jsonArray){
        var strLarge=jsonArray[tmp].large_category;
        var strMedium=jsonArray[tmp].medium_category;
        var strSmall=jsonArray[tmp].small_category;
        if(tmp==0){
          continue;
        }
        if(rstLarge.indexOf(strLarge)==-1){
          rstLarge.push(strLarge);
        }
        var idxLarge=rstLarge.indexOf(strLarge);
        if(!rstMedium[idxLarge])
        {
          rstMedium[idxLarge] = new Array();
          rstSmall[idxLarge] = new Array();
          rstMedium[idxLarge].push(strMedium);
        }
        else
        {
          if(rstMedium[idxLarge].indexOf(strMedium)==-1)
          {
            rstMedium[idxLarge].push(strMedium);
          }
        }
        //----------------------------------------------------
        var idxMedium=rstMedium[idxLarge].indexOf(strMedium);
        if(!rstSmall[idxLarge][idxMedium])
        {
            rstSmall[idxLarge][idxMedium] = new Array();
            rstSmall[idxLarge][idxMedium].push(strSmall);
        }
        else
        {
          console.log(rstSmall);
          if(rstSmall[idxLarge][idxMedium].indexOf(strSmall)==-1)
          {
            rstSmall[idxLarge][idxMedium].push(strSmall);
          }
        }
      }
      //rstLarge = 대분류
      //rstMedium = 중분류
      //rstSmall = 소분류
      //대중소 기준으로 같은 index에 같은 값이 들어있음.
    }, 1000);
    
    
    //json file load : https://codepen.io/KryptoniteDove/post/load-json-file-locally-using-pure-javascript
  </script>
</body>

</html>
